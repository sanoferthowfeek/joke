import readline from "node:readline";
import { wxt } from "./wxt.mjs";
import pc from "picocolors";
export function createKeyboardShortcuts(server) {
  let isWatching = false;
  let rl;
  const handleInput = (line) => {
    if (line.trim() === "o") {
      server.restartBrowser();
    }
  };
  return {
    start() {
      if (isWatching) return;
      rl = readline.createInterface({
        input: process.stdin,
        terminal: false
        // Don't intercept ctrl+C, ctrl+Z, etc
      });
      rl.on("line", handleInput);
      isWatching = true;
    },
    stop() {
      if (!isWatching) return;
      if (rl) {
        rl.close();
        rl = void 0;
      }
      isWatching = false;
    },
    printHelp() {
      if (!wxt.config.runnerConfig.config.disabled) {
        wxt.logger.info(
          `${pc.dim("Press")} ${pc.bold("o + enter")} ${pc.dim("to reopen the browser")}`
        );
      }
    }
  };
}
